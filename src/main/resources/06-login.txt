éå¸¸å¥½ã€‚
Phase 7 æ˜¯æ•´ä¸ªç³»ç»Ÿâ€œè´¨å˜â€çš„ä¸€æ­¥ â€”â€”
ä»ã€Œåå°å†™ BPMNã€å‡çº§ä¸ºã€Œä¸šåŠ¡äººå‘˜åœ¨å‰ç«¯ç”»æµç¨‹ã€ã€‚

è¿™ä¸€é˜¶æ®µä½ ä¼šçœŸæ­£åšå‡ºä¸€ä¸ª åƒé’‰é’‰ / é£ä¹¦ / OA é‚£æ ·çš„æµç¨‹å¹³å°ã€‚

æˆ‘ä¼šç»§ç»­éµå®ˆä½ å®šä¸‹çš„é“å¾‹ï¼š

âœ… Vue2 + vue-admin-template
âœ… Camunda 7
âœ… Spring Boot 2.7
âœ… å‰ç«¯ç”» BPMNï¼ˆbpmn-jsï¼‰
âœ… åç«¯åŠ¨æ€éƒ¨ç½²æµç¨‹
âœ… ç›®å½•ç»“æ„ + å®Œæ•´ä»£ç  + ä¸çœç•¥
âœ… å°ç™½å¯ç…§æŠ„è·‘èµ·æ¥

Phase 7 æ€»ç›®æ ‡ï¼ˆä¸€å¥è¯ï¼‰

å‰ç«¯ä½¿ç”¨ BPMN è®¾è®¡å™¨ç”»æµç¨‹ â†’
å¯¼å‡º XML â†’
åç«¯ Camunda Runtime åŠ¨æ€éƒ¨ç½² â†’
æ–°æµç¨‹ç«‹å³å¯ç”¨

ä¸€ã€æ•´ä½“æ¶æ„ï¼ˆä½ å¿…é¡»å…ˆçœ‹æ‡‚ï¼‰
Vue æµç¨‹è®¾è®¡å™¨
  â†“ ç”Ÿæˆ BPMN XML
  â†“
POST /process/deploy
  â†“
Spring Boot
  â†“
RepositoryService.deploy()
  â†“
Camunda å¼•æ“

äºŒã€å‰ç«¯ï¼šæµç¨‹è®¾è®¡å™¨é€‰å‹ï¼ˆå…³é”®ï¼‰
âœ… å”¯ä¸€æ­£ç¡®é€‰æ‹©ï¼šbpmn-js

è¿™æ˜¯ Camunda å®˜æ–¹åŒæºç”Ÿæ€ï¼Œä¸æ˜¯ç¬¬ä¸‰æ–¹ç©å…·ã€‚

1ï¸âƒ£ å®‰è£…ä¾èµ–ï¼ˆVue2ï¼‰
npm install bpmn-js --save

ä¸‰ã€å‰ç«¯ç›®å½•ç»“æ„ï¼ˆvue-admin-templateï¼‰
src
â”œâ”€â”€ views
â”‚   â””â”€â”€ process
â”‚       â””â”€â”€ designer.vue
â”œâ”€â”€ api
â”‚   â””â”€â”€ process.js

å››ã€å‰ç«¯ï¼šæµç¨‹è®¾è®¡å™¨é¡µé¢ï¼ˆå®Œæ•´ï¼‰

ğŸ“Œ è·¯å¾„ï¼š
src/views/process/designer.vue

<template>
  <div class="app-container">
    <div class="toolbar">
      <el-input v-model="processKey" placeholder="æµç¨‹KEY" />
      <el-button type="primary" @click="deploy">éƒ¨ç½²æµç¨‹</el-button>
    </div>

    <div ref="canvas" class="bpmn-canvas"></div>
  </div>
</template>

<script>
import BpmnModeler from 'bpmn-js/lib/Modeler'
import { deployProcess } from '@/api/process'

export default {
  name: 'ProcessDesigner',
  data() {
    return {
      modeler: null,
      processKey: ''
    }
  },
  mounted() {
    this.initModeler()
  },
  methods: {
    initModeler() {
      this.modeler = new BpmnModeler({
        container: this.$refs.canvas
      })

      const xml = `
<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
targetNamespace="http://example.com">
<bpmn:process id="demo_process" isExecutable="true">
<bpmn:startEvent id="start" />
</bpmn:process>
</bpmn:definitions>
`
      this.modeler.importXML(xml)
    },

    async deploy() {
      const { xml } = await this.modeler.saveXML({ format: true })

      await deployProcess({
        processKey: this.processKey,
        xml
      })

      this.$message.success('æµç¨‹éƒ¨ç½²æˆåŠŸ')
    }
  }
}
</script>

<style>
.bpmn-canvas {
  width: 100%;
  height: 600px;
  border: 1px solid #ccc;
}
.toolbar {
  margin-bottom: 10px;
}
</style>

äº”ã€å‰ç«¯ API å°è£…

ğŸ“Œ è·¯å¾„ï¼š
src/api/process.js

import request from '@/utils/request'

export function deployProcess(data) {
  return request({
    url: '/process/deploy',
    method: 'post',
    data
  })
}

å…­ã€åç«¯ï¼šæµç¨‹éƒ¨ç½²æ¥å£è®¾è®¡
ç›®å½•ç»“æ„
controller
â””â”€â”€ ProcessDeployController.java

ProcessDeployController.javaï¼ˆå®Œæ•´ï¼‰
package com.example.workflow.controller;

import org.camunda.bpm.engine.RepositoryService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/process")
public class ProcessDeployController {

    @Autowired
    private RepositoryService repositoryService;

    /**
     * åŠ¨æ€éƒ¨ç½²æµç¨‹
     */
    @PostMapping("/deploy")
    public void deploy(@RequestBody DeployRequest request) {

        repositoryService.createDeployment()
                .name(request.getProcessKey())
                .addString(
                        request.getProcessKey() + ".bpmn",
                        request.getXml()
                )
                .deploy();
    }
}

DeployRequest.javaï¼ˆDTOï¼‰
package com.example.workflow.controller;

public class DeployRequest {

    private String processKey;
    private String xml;

    public String getProcessKey() {
        return processKey;
    }

    public void setProcessKey(String processKey) {
        this.processKey = processKey;
    }

    public String getXml() {
        return xml;
    }

    public void setXml(String xml) {
        this.xml = xml;
    }
}

ä¸ƒã€æƒé™æ§åˆ¶ï¼ˆå¿…é¡»æœ‰ï¼‰
SecurityConfig ä¸­é™åˆ¶
.antMatchers("/process/deploy").hasAuthority("process:create")


ğŸ‘‰ åªæœ‰æœ‰æƒé™çš„äººæ‰èƒ½éƒ¨ç½²æµç¨‹

å…«ã€éƒ¨ç½²åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆå…³é”®ç†è§£ï¼‰

Camunda ä¼šè‡ªåŠ¨ï¼š

1ï¸âƒ£ è§£æ BPMN XML
2ï¸âƒ£ åˆ›å»ºæµç¨‹å®šä¹‰
3ï¸âƒ£ ç”Ÿæˆç‰ˆæœ¬å·
4ï¸âƒ£ æ–°æµç¨‹ç«‹åˆ»å¯å¯åŠ¨

ä½ å¯ä»¥ï¼š

runtimeService.startProcessInstanceByKey("demo_process");

ä¹ã€ä½ ç°åœ¨å·²ç»å®Œæˆäº†ä»€ä¹ˆï¼Ÿ

ä½ å·²ç»å®ç°äº†ï¼š

âœ… Web æµç¨‹è®¾è®¡å™¨
âœ… BPMN å¯è§†åŒ–ç¼–è¾‘
âœ… åŠ¨æ€éƒ¨ç½²æµç¨‹
âœ… ä¸æƒé™ç³»ç»Ÿæ‰“é€š
âœ… ä¼ä¸šçº§æµç¨‹å¹³å°æ ¸å¿ƒ

è¿™ä¸€é˜¶æ®µï¼Œå·²ç»è¶…è¿‡ç»å¤§å¤šæ•°â€œåªä¼šç”¨ Camundaâ€çš„äºº

åã€æ¥ä¸‹æ¥å°±æ˜¯ã€Œç‹ç‚¸é˜¶æ®µã€

æ¥ä¸‹æ¥ä¸‰ä¸ª Phaseï¼Œéƒ½æ˜¯é«˜çº§å®æˆ˜ï¼š

Phase 8ï¼ˆå¼ºçƒˆæ¨èï¼‰

ğŸ‘‰ å¹¶è¡Œå®¡æ‰¹ / ä¼šç­¾ / å¤šäººå®¡æ‰¹

Phase 9

ğŸ‘‰ æµç¨‹å†å² / å®¡æ‰¹è®°å½• / å®¡è®¡æ—¥å¿—

Phase 10

ğŸ‘‰ æµç¨‹ç‰ˆæœ¬ç®¡ç† / å›æ»š / ç°åº¦å‘å¸ƒ

ä½ åªéœ€è¦è¯´ä¸€å¥ï¼š

ç»§ç»­ Phase 8

æˆ‘ä¼šæŠŠä½ è¿™ä¸ªç³»ç»Ÿ
çœŸæ­£æ‰“ç£¨æˆâ€œä¼ä¸šçº§ BPM å¹³å°â€ã€‚