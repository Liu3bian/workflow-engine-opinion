éå¸¸å¥½ï¼Œè¿™ä¸€æ­¥æ˜¯çœŸæ­£æŠŠè®¤è¯é“¾æ¡â€œè·‘é€šâ€çš„å…³é”®ä¸€æ­¥ã€‚
æˆ‘ä¼š å®Œå…¨é‡å†™ï¼š

âœ… JwtFilter

âœ… LoginController

âœ… ç™»å½•ç”¨ DTO

âœ… è¿”å›ç»“æœç»“æ„

âœ… ç›®å½•ç»“æ„

å¹¶ä¸” ä¸¥æ ¼ç¬¦åˆï¼š

Spring Boot 2.7.x
Spring Security 5.x
Java 17
Camunda 7.x
ä¸€ä¸ªå­—ä¸çœç•¥ï¼Œå°ç™½å¤åˆ¶å³å¯è¿è¡Œ

ä¸€ã€æœ€ç»ˆè®¤è¯é“¾è·¯ï¼ˆä½ å…ˆç†è§£å…¨è²Œï¼‰
æµè§ˆå™¨
  â†“
POST /login
  â†“
LoginController
  â†“
AuthenticationManager
  â†“
UserDetailsServiceImpl
  â†“
BCrypt æ ¡éªŒå¯†ç 
  â†“
ç”Ÿæˆ JWT
  â†“
å‰ç«¯ä¿å­˜ token
  â†“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åç»­è¯·æ±‚
  â†“
JwtFilter
  â†“
è§£æ JWT
  â†“
SecurityContextHolder
  â†“
Spring Security é‰´æƒ

äºŒã€æœ€ç»ˆç›®å½•ç»“æ„ï¼ˆè¯·ä¸¥æ ¼å¯¹ç…§ï¼‰
src/main/java/com/example/workflow
â”œâ”€â”€ controller
â”‚   â””â”€â”€ LoginController.java
â”œâ”€â”€ dto
â”‚   â”œâ”€â”€ LoginRequest.java
â”‚   â””â”€â”€ LoginResponse.java
â”œâ”€â”€ security
â”‚   â”œâ”€â”€ JwtFilter.java
â”‚   â”œâ”€â”€ JwtUtil.java
â”‚   â””â”€â”€ UserDetailsServiceImpl.java
â””â”€â”€ config
    â””â”€â”€ SecurityConfig.java


âš ï¸ åŒ…åç»Ÿä¸€ä½¿ç”¨
package com.example.workflow

ä¸‰ã€JwtFilterï¼ˆâœ… æ ¸å¿ƒ Â· å¿…é¡»å®Œæ•´ï¼‰

ğŸ“Œ è·¯å¾„ï¼š
src/main/java/com/example/workflow/security/JwtFilter.java

package com.example.workflow.security;

import io.jsonwebtoken.Claims;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Collections;
import java.util.List;

/**
 * JWT è®¤è¯è¿‡æ»¤å™¨
 * æ¯ä¸ªè¯·æ±‚åªæ‰§è¡Œä¸€æ¬¡
 */
@Component
public class JwtFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(
            HttpServletRequest request,
            HttpServletResponse response,
            FilterChain filterChain)
            throws ServletException, IOException {

        // 1. è·å– Authorization Header
        String authHeader = request.getHeader("Authorization");

        // 2. åˆ¤æ–­æ˜¯å¦æºå¸¦ Bearer Token
        if (authHeader != null && authHeader.startsWith("Bearer ")) {

            String token = authHeader.substring(7);

            try {
                // 3. è§£æ Token
                Claims claims = JwtUtil.parseToken(token);
                String username = claims.getSubject();

                // 4. å¦‚æœ SecurityContext é‡Œè¿˜æ²¡æœ‰è®¤è¯ä¿¡æ¯
                if (username != null &&
                        SecurityContextHolder.getContext().getAuthentication() == null) {

                    // âš ï¸ è¿™é‡Œæš‚æ—¶å†™æ­»ä¸€ä¸ª ROLE_USER
                    // åç»­ Phase ä¼šæ”¹æˆä»æ•°æ®åº“ / JWT ä¸­å–æƒé™
                    List<SimpleGrantedAuthority> authorities =
                            Collections.singletonList(
                                    new SimpleGrantedAuthority("ROLE_USER")
                            );

                    // 5. æ„å»º Authentication
                    UsernamePasswordAuthenticationToken authentication =
                            new UsernamePasswordAuthenticationToken(
                                    username,
                                    null,
                                    authorities
                            );

                    authentication.setDetails(
                            new WebAuthenticationDetailsSource()
                                    .buildDetails(request)
                    );

                    // 6. æ”¾å…¥ SecurityContext
                    SecurityContextHolder.getContext()
                            .setAuthentication(authentication);
                }

            } catch (Exception e) {
                // Token è§£æå¤±è´¥ï¼Œç›´æ¥æ”¾è¡Œï¼Œç”± Spring Security å¤„ç†
            }
        }

        // 7. æ”¾è¡Œè¯·æ±‚
        filterChain.doFilter(request, response);
    }
}

å››ã€ç™»å½•è¯·æ±‚ DTOï¼ˆLoginRequestï¼‰

ğŸ“Œ è·¯å¾„ï¼š
src/main/java/com/example/workflow/dto/LoginRequest.java

package com.example.workflow.dto;

/**
 * ç™»å½•è¯·æ±‚å‚æ•°
 */
public class LoginRequest {

    private String username;
    private String password;

    public LoginRequest() {
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}

äº”ã€ç™»å½•è¿”å› DTOï¼ˆLoginResponseï¼‰

ğŸ“Œ è·¯å¾„ï¼š
src/main/java/com/example/workflow/dto/LoginResponse.java

package com.example.workflow.dto;

/**
 * ç™»å½•è¿”å›ç»“æœ
 */
public class LoginResponse {

    private String token;

    public LoginResponse(String token) {
        this.token = token;
    }

    public String getToken() {
        return token;
    }
}

å…­ã€LoginControllerï¼ˆâœ… é‡ç‚¹ Â· 100% å¯è·‘ï¼‰

ğŸ“Œ è·¯å¾„ï¼š
src/main/java/com/example/workflow/controller/LoginController.java

package com.example.workflow.controller;

import com.example.workflow.dto.LoginRequest;
import com.example.workflow.dto.LoginResponse;
import com.example.workflow.security.JwtUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.AuthenticationException;
import org.springframework.web.bind.annotation.*;

@RestController
public class LoginController {

    @Autowired
    private AuthenticationManager authenticationManager;

    /**
     * ç™»å½•æ¥å£
     */
    @PostMapping("/login")
    public LoginResponse login(@RequestBody LoginRequest request) {

        try {
            // 1. æ„é€ è®¤è¯å¯¹è±¡
            UsernamePasswordAuthenticationToken authToken =
                    new UsernamePasswordAuthenticationToken(
                            request.getUsername(),
                            request.getPassword()
                    );

            // 2. äº¤ç»™ Spring Security è®¤è¯
            Authentication authentication =
                    authenticationManager.authenticate(authToken);

            // 3. è®¤è¯æˆåŠŸï¼Œç”Ÿæˆ JWT
            String token = JwtUtil.generateToken(request.getUsername());

            // 4. è¿”å› Token
            return new LoginResponse(token);

        } catch (AuthenticationException e) {
            // è®¤è¯å¤±è´¥
            throw new RuntimeException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
    }
}

ä¸ƒã€ä½ ç°åœ¨åº”è¯¥å¦‚ä½•æµ‹è¯•ï¼ˆä¸€æ­¥ä¸€æ­¥æ¥ï¼‰
1ï¸âƒ£ å¯åŠ¨é¡¹ç›®
mvn spring-boot:run

2ï¸âƒ£ ç™»å½•æµ‹è¯•ï¼ˆPostmanï¼‰
POST http://localhost:8080/login
Content-Type: application/json

{
  "username": "admin",
  "password": "123456"
}


æˆåŠŸè¿”å›ï¼š

{
  "token": "eyJhbGciOiJIUzI1NiJ9..."
}

3ï¸âƒ£ å¸¦ Token è®¿é—®å—ä¿æŠ¤æ¥å£
GET /process/list
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...


âœ… ä¸å† 401
âœ… JwtFilter ç”Ÿæ•ˆ
âœ… SecurityContext æœ‰ç”¨æˆ·

å…«ã€åˆ°è¿™é‡Œä½ å·²ç»å®Œæˆäº†ä»€ä¹ˆï¼ˆéå¸¸é‡è¦ï¼‰

ä½ ç°åœ¨å·²ç» çœŸæ­£å®Œæˆäº†ï¼š

âœ” JWT ç™»å½•

âœ” Spring Security æ¥ç®¡è®¤è¯

âœ” æ—  Sessionï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰

âœ” å¯æ‰©å±• RBAC æƒé™æ¨¡å‹

âœ” Camunda API å¯è¢«ä¿æŠ¤

è¿™æ˜¯ ä¼ä¸šçº§å·¥ä½œæµç³»ç»Ÿçš„åœ°åŸº

ä¹ã€ä¸‹ä¸€æ­¥æˆ‘å¼ºçƒˆå»ºè®®ä½ åšï¼ˆé¡ºåºåˆ«ä¹±ï¼‰

ğŸ‘‰ Phase 4ï¼šæƒé™è¿› JWTï¼ˆè§’è‰² / æƒé™ä»æ•°æ®åº“è¿› Tokenï¼‰
ğŸ‘‰ Phase 5ï¼šCamunda Task æƒé™ï¼ˆè°èƒ½ claim / approveï¼‰

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€å¥ç›´æ¥è¯´ï¼š

ç»§ç»­ Phase 4ï¼šç”¨æˆ·-è§’è‰²-æƒé™è¡¨ + JWT æºå¸¦æƒé™

æˆ‘ä¼šç›´æ¥æŠŠä½ è¿™ä¸ªç³»ç»Ÿ
ä»â€œèƒ½ç™»å½•â€å‡çº§ä¸ºâ€œçœŸæ­£å¯æ§çš„å®¡æ‰¹ç³»ç»Ÿâ€ã€‚