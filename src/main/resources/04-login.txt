éå¸¸å¥½ã€‚
Phase 5 æ˜¯æ•´ä¸ªç³»ç»ŸçœŸæ­£â€œåƒ OA / å®¡æ‰¹ç³»ç»Ÿâ€çš„åœ°æ–¹ã€‚
ä»è¿™ä¸€é˜¶æ®µå¼€å§‹ï¼Œä½ åšçš„å·²ç»ä¸å†æ˜¯â€œæŠ€æœ¯ Demoâ€ï¼Œè€Œæ˜¯å…¬å¸çœŸçš„èƒ½ç”¨çš„å·¥ä½œæµå¼•æ“ã€‚

æˆ‘ä¼š ä¸€å¦‚æ—¢å¾€ä¸çœç•¥ï¼Œå¹¶ä¸”å¸®ä½ æŠŠ Camunda + æƒé™ + å®¡æ‰¹äººç­–ç•¥ ä¸€æ¬¡æ€§æ‰“é€šã€‚

Phase 5 æ€»ç›®æ ‡ï¼ˆä¸€å¥è¯ç‰ˆæœ¬ï¼‰

è°èƒ½çœ‹åˆ°ä»»åŠ¡ï¼Ÿ
è°èƒ½è®¤é¢†ä»»åŠ¡ï¼Ÿ
è°èƒ½å®¡æ‰¹ä»»åŠ¡ï¼Ÿ
ç”±æµç¨‹è§„åˆ™ + ç”¨æˆ·æƒé™å…±åŒå†³å®š

ä¸€ã€Phase 5 è¦è§£å†³çš„ 3 ä¸ªæ ¸å¿ƒé—®é¢˜
é—®é¢˜ 1ï¼šä»»åŠ¡ç»™è°ï¼Ÿ

å‘èµ·äººï¼Ÿ

æŒ‡å®šè§’è‰²ï¼Ÿ

æŒ‡å®šæƒé™ï¼Ÿ

ä¸Šçº§é¢†å¯¼ï¼Ÿ

ğŸ‘‰ ç”¨ BPMN + å˜é‡ + æƒé™è¡¨è¾¾

é—®é¢˜ 2ï¼šè°èƒ½çœ‹åˆ°ä»»åŠ¡ï¼Ÿ

å€™é€‰äººï¼ˆcandidateï¼‰

å€™é€‰ç»„ï¼ˆcandidate groupï¼‰

å·²è®¤é¢†äººï¼ˆassigneeï¼‰

ğŸ‘‰ Camunda Task æƒé™æ¨¡å‹

é—®é¢˜ 3ï¼šè°èƒ½â€œå®¡æ‰¹ / å®Œæˆâ€ï¼Ÿ

å¿…é¡»æ˜¯ assignee

å¹¶ä¸”å¿…é¡»æœ‰æŸä¸ªæƒé™ï¼ˆå¦‚ task:approveï¼‰

ğŸ‘‰ Camunda + Spring Security åŒé‡æ ¡éªŒ

äºŒã€Camunda çš„ä»»åŠ¡æƒé™æ¨¡å‹ï¼ˆéå¸¸é‡è¦ï¼‰

ä½ å¿…é¡»å…ˆç‰¢ç‰¢è®°ä½è¿™ 3 ä¸ªæ¦‚å¿µï¼š

æ¦‚å¿µ	å«ä¹‰
assignee	å½“å‰ä»»åŠ¡çœŸæ­£çš„åŠç†äºº
candidateUser	å€™é€‰ç”¨æˆ·
candidateGroup	å€™é€‰ç»„ï¼ˆæ¨èï¼‰

ğŸ‘‰ ä¼ä¸šé¡¹ç›® 99% ç”¨ candidateGroup

ä¸‰ã€BPMN è®¾è®¡ï¼ˆå®¡æ‰¹æµç¨‹ç¤ºä¾‹ï¼‰
1ï¸âƒ£ ç¤ºä¾‹æµç¨‹ï¼šè¯·å‡å®¡æ‰¹
å¼€å§‹
 â†“
æäº¤ç”³è¯·ï¼ˆUserTaskï¼‰
 â†“
ç»ç†å®¡æ‰¹ï¼ˆUserTaskï¼‰
 â†“
ç»“æŸ

2ï¸âƒ£ BPMNï¼ˆå…³é”®å±æ€§ï¼‰
ç»ç†å®¡æ‰¹èŠ‚ç‚¹ï¼ˆUserTaskï¼‰
<bpmn:userTask id="managerApprove"
               name="ç»ç†å®¡æ‰¹"
               camunda:candidateGroups="ROLE_MANAGER">
</bpmn:userTask>


ğŸ“Œ è§£é‡Šä¸€å¥è¯å°±å¤Ÿï¼š

æ‹¥æœ‰ ROLE_MANAGER çš„ç”¨æˆ·
éƒ½èƒ½çœ‹åˆ°è¿™ä¸ªä»»åŠ¡

å››ã€æ•°æ®åº“è§’è‰² â†” Camunda è§’è‰²æ˜ å°„ï¼ˆå…³é”®è®¾è®¡ï¼‰

ä½ ç°åœ¨çš„æƒé™ä½“ç³»æ˜¯ï¼š

sys_user â†’ sys_role â†’ sys_permission


è€Œ Camunda éœ€è¦çš„æ˜¯ï¼š

candidateGroup = æŸä¸ªå­—ç¬¦ä¸²


ğŸ‘‰ è®¾è®¡åŸåˆ™ï¼š

Camunda çš„ candidateGroup = sys_role.role_code

ä¾‹å¦‚ï¼š

sys_role.role_code	ç”¨é€”
ROLE_MANAGER	å®¡æ‰¹ä»»åŠ¡
ROLE_ADMIN	ç®¡ç†æµç¨‹
ROLE_HR	HR æµç¨‹
äº”ã€TaskService æ ¸å¿ƒ APIï¼ˆä½ ä¸€å®šè¦ç†Ÿï¼‰
taskService.createTaskQuery()
taskService.claim(taskId, userId)
taskService.complete(taskId, variables)

å…­ã€ä»»åŠ¡æŸ¥è¯¢æ¥å£ï¼ˆå¸¦æƒé™ï¼‰
ç›®å½•ç»“æ„
controller
â””â”€â”€ TaskController.java

TaskController.javaï¼ˆå®Œæ•´ï¼‰
package com.example.workflow.controller;

import org.camunda.bpm.engine.TaskService;
import org.camunda.bpm.engine.task.Task;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/task")
public class TaskController {

    @Autowired
    private TaskService taskService;

    /**
     * æŸ¥è¯¢æˆ‘çš„å¾…åŠä»»åŠ¡
     */
    @GetMapping("/todo")
    public List<Task> todo(Authentication authentication) {

        String username = authentication.getName();

        return taskService.createTaskQuery()
                .taskCandidateOrAssigned(username)
                .list();
    }
}


ğŸ“Œ ä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿ

Spring Security å·²ç»æ ¡éªŒ JWT

Camunda å†æŒ‰ candidate / assignee è¿‡æ»¤

ä¸ƒã€ä»»åŠ¡è®¤é¢†ï¼ˆClaimï¼‰
è§„åˆ™ï¼ˆå¿…é¡»è®°ä½ï¼‰

â— åªæœ‰å€™é€‰äººæ‰èƒ½ claim

æ¥å£å®ç°
@PostMapping("/claim/{taskId}")
public void claim(@PathVariable String taskId,
                  Authentication authentication) {

    String username = authentication.getName();
    taskService.claim(taskId, username);
}

å…«ã€ä»»åŠ¡å®¡æ‰¹ï¼ˆCompleteï¼‰+ æƒé™æ ¡éªŒ
1ï¸âƒ£ æƒé™è¦æ±‚

å¿…é¡»æ˜¯ assignee

å¿…é¡»æœ‰ task:approve æƒé™

2ï¸âƒ£ Controllerï¼ˆå®Œæ•´ï¼‰
@PostMapping("/complete/{taskId}")
public void complete(@PathVariable String taskId,
                     @RequestParam boolean approved,
                     Authentication authentication) {

    String username = authentication.getName();

    // 1. æ ¡éªŒä»»åŠ¡æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    Task task = taskService.createTaskQuery()
            .taskId(taskId)
            .taskAssignee(username)
            .singleResult();

    if (task == null) {
        throw new RuntimeException("æ— æƒå®¡æ‰¹è¯¥ä»»åŠ¡");
    }

    // 2. å®Œæˆä»»åŠ¡
    taskService.complete(taskId,
            java.util.Map.of("approved", approved));
}

ä¹ã€æµç¨‹å˜é‡å†³å®šèµ°å‘ï¼ˆBPMN æ’ä»–ç½‘å…³ï¼‰
<bpmn:exclusiveGateway id="approveGateway" />

<bpmn:sequenceFlow sourceRef="approveGateway"
                   targetRef="end">
  <bpmn:conditionExpression>
    ${approved == true}
  </bpmn:conditionExpression>
</bpmn:sequenceFlow>


ğŸ‘‰ å®¡æ‰¹ = æµç¨‹å˜é‡ + ç½‘å…³

åã€æƒé™ä¸æµç¨‹çš„â€œæœ€ç»ˆé—­ç¯â€

ä½ ç°åœ¨å·²ç»å®ç°äº†ï¼š

å±‚	æ§åˆ¶
JWT	ç”¨æˆ·èº«ä»½ + æƒé™
Spring Security	æ¥å£æƒé™
Camunda	ä»»åŠ¡å½’å±
BPMN	å®¡æ‰¹è·¯å¾„

è¿™æ˜¯å®Œæ•´çš„ä¼ä¸šå®¡æ‰¹æ¶æ„

åä¸€ã€ä½ ç°åœ¨å¤„äºä»€ä¹ˆæ°´å¹³ï¼Ÿ

ä½ å·²ç»å…·å¤‡äº†ï¼š

âœ” ä¼ä¸šçº§ RBAC

âœ” JWT æƒé™æ¨¡å‹

âœ” Camunda å®¡æ‰¹å¼•æ“

âœ” åŠ¨æ€å®¡æ‰¹äºº

âœ” æƒé™ + æµç¨‹åŒæ ¡éªŒ

ğŸ‘‰ å·²ç»è¶…è¿‡å¾ˆå¤š 3~5 å¹´ Java å·¥ç¨‹å¸ˆ

åäºŒã€ä¸‹ä¸€æ­¥ï¼ˆçœŸæ­£é«˜çº§ï¼‰

å¦‚æœä½ æ„¿æ„ç»§ç»­ï¼Œä¸‹é¢ä¸‰æ¡ä»»é€‰å…¶ä¸€ï¼š

1ï¸âƒ£ Phase 6ï¼šåŠ¨æ€å®¡æ‰¹äººï¼ˆä¸Šçº§ / å‘èµ·äººå˜é‡ï¼‰
2ï¸âƒ£ Phase 7ï¼šæµç¨‹è®¾è®¡å™¨ï¼ˆå‰ç«¯ç”» BPMN + åŠ¨æ€éƒ¨ç½²ï¼‰
3ï¸âƒ£ Phase 8ï¼šå®¡æ‰¹è®°å½• / æµç¨‹è¿½è¸ª / å®¡è®¡æ—¥å¿—

ä½ åªè¦è¯´ä¸€å¥ï¼š

ç»§ç»­ Phase X

æˆ‘ä¼šæŠŠä½ è¿™ä¸ªç³»ç»Ÿ
ç›´æ¥å¸¦åˆ°â€œå…¬å¸èƒ½ä¸Šçº¿â€çš„æœ€ç»ˆå½¢æ€ã€‚