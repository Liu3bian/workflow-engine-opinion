å¤ªå¥½äº†ã€‚
Phase 6 = å®¡æ‰¹ç³»ç»Ÿâ€œæ˜¯å¦åƒçœŸå…¬å¸â€çš„åˆ†æ°´å²­ã€‚

ä»è¿™ä¸€é˜¶æ®µå¼€å§‹ï¼Œæˆ‘ä»¬è¦è§£å†³ æ‰€æœ‰çœŸå®ä¼ä¸šéƒ½ä¼šé—®çš„é—®é¢˜ï¼š

â“â€œè¿™ä¸ªæµç¨‹ä¸æ˜¯å†™æ­»ç»™æŸä¸ªè§’è‰²çš„ï¼Œ
èƒ½ä¸èƒ½æ ¹æ®å‘èµ·äººï¼Œè‡ªåŠ¨æ‰¾ä»–çš„ä¸Šçº§æ¥å®¡æ‰¹ï¼Ÿâ€

ç­”æ¡ˆæ˜¯ï¼šå¯ä»¥ï¼Œè€Œä¸”è¿™æ­£æ˜¯ Camunda çš„å¼ºé¡¹ã€‚

æˆ‘ä¼šç»§ç»­ä¿æŒä½ çš„æ ‡å‡†ï¼š

âœ… Spring Boot 2.7
âœ… Camunda 7
âœ… JWT + Security å·²å®Œæˆ
âœ… åŠ¨æ€å®¡æ‰¹äººï¼ˆå˜é‡é©±åŠ¨ï¼‰
âœ… ä»£ç  + BPMN + è¡¨ç»“æ„ + Controller å…¨å†™å…¨
âœ… å°ç™½å¯ç›´æ¥ç…§æŠ„

Phase 6 æ€»ç›®æ ‡ï¼ˆä¸€å¥è¯ï¼‰

å®¡æ‰¹äººä¸æ˜¯å†™æ­»åœ¨ BPMN é‡Œçš„ï¼Œè€Œæ˜¯ï¼š
ç™»å½•ç”¨æˆ· â†’ æŸ¥ä¸Šçº§ â†’ å†™å…¥æµç¨‹å˜é‡ â†’ Camunda è‡ªåŠ¨æŒ‡æ´¾ä»»åŠ¡

ä¸€ã€ä¼ä¸šé‡Œâ€œåŠ¨æ€å®¡æ‰¹äººâ€çš„ 3 ç§å¸¸è§æ¨¡å¼

ä½ åœ¨å…¬å¸é‡Œ 99% ä¼šé‡åˆ°ä¸‹é¢ä¸‰ç§ï¼š

æ¨¡å¼	è¯´æ˜
å‘èµ·äººè‡ªå·±	å¡«è¡¨èŠ‚ç‚¹
å‘èµ·äººä¸Šçº§	è¯·å‡ / æŠ¥é”€
æŸè§’è‰² + æ¡ä»¶	é‡‘é¢ > 10 ä¸‡ â†’ æ€»ç›‘

ğŸ‘‰ Phase 6 è§£å†³å‰ä¸¤ç§

äºŒã€æ•°æ®åº“è®¾è®¡ï¼ˆä¸Šçº§å…³ç³»ï¼‰
1ï¸âƒ£ sys_user è¡¨å‡çº§ï¼ˆéå¸¸å…³é”®ï¼‰
ALTER TABLE sys_user
ADD COLUMN leader_id BIGINT NULL;

å«ä¹‰
å­—æ®µ	å«ä¹‰
leader_id	ç›´å±ä¸Šçº§çš„ user.id
2ï¸âƒ£ ç¤ºä¾‹æ•°æ®
-- admin æ˜¯ leader
UPDATE sys_user SET leader_id = 1 WHERE username = 'user1';

ä¸‰ã€BPMN æ ¸å¿ƒæ€æƒ³ï¼ˆå…ˆç†è§£ï¼‰
âŒ é”™è¯¯åšæ³•ï¼ˆå†™æ­»ï¼‰
camunda:candidateGroups="ROLE_MANAGER"

âœ… æ­£ç¡®åšæ³•ï¼ˆå˜é‡ï¼‰
camunda:assignee="${approver}"


ğŸ‘‰ è°æ˜¯ approverï¼Ÿ
ç”±ä½ åœ¨å¯åŠ¨æµç¨‹æ—¶å†³å®š

å››ã€BPMN ç¤ºä¾‹ï¼ˆå®Œæ•´æ€è·¯ï¼‰
1ï¸âƒ£ å®¡æ‰¹èŠ‚ç‚¹ï¼ˆUserTaskï¼‰
<bpmn:userTask id="leaderApprove"
               name="ç›´å±é¢†å¯¼å®¡æ‰¹"
               camunda:assignee="${leader}">
</bpmn:userTask>


ğŸ“Œ å«ä¹‰ä¸€å¥è¯ï¼š

leader å˜é‡çš„å€¼ = æŸä¸ªç”¨æˆ·å

äº”ã€æµç¨‹å¯åŠ¨æ—¶ï¼šå†™å…¥â€œåŠ¨æ€å®¡æ‰¹äººâ€
ç›®å½•ç»“æ„
controller
â””â”€â”€ ProcessController.java
service
â””â”€â”€ UserService.java
mapper
â””â”€â”€ UserMapper.javaï¼ˆå·²å­˜åœ¨ï¼‰

1ï¸âƒ£ UserServiceï¼ˆæŸ¥ä¸Šçº§ï¼‰
package com.example.workflow.service;

import com.example.workflow.entity.SysUser;
import com.example.workflow.mapper.UserMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserService {

    @Autowired
    private UserMapper userMapper;

    public SysUser findLeaderByUsername(String username) {

        SysUser user = userMapper.findByUsername(username);
        if (user == null || user.getLeaderId() == null) {
            return null;
        }
        return userMapper.findById(user.getLeaderId());
    }
}


âš ï¸ å¦‚æœä½ è¿˜æ²¡æœ‰ findByIdï¼Œé©¬ä¸Šè¡¥

@Select("select * from sys_user where id = #{id}")
SysUser findById(Long id);

2ï¸âƒ£ ProcessControllerï¼ˆå¯åŠ¨æµç¨‹ï¼‰
package com.example.workflow.controller;

import com.example.workflow.entity.SysUser;
import com.example.workflow.service.UserService;
import org.camunda.bpm.engine.RuntimeService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("/process")
public class ProcessController {

    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private UserService userService;

    /**
     * å¯åŠ¨è¯·å‡æµç¨‹
     */
    @PostMapping("/start/leave")
    public void startLeaveProcess(Authentication authentication) {

        String starter = authentication.getName();

        SysUser leader = userService.findLeaderByUsername(starter);
        if (leader == null) {
            throw new RuntimeException("æœªé…ç½®ç›´å±é¢†å¯¼");
        }

        Map<String, Object> vars = new HashMap<>();
        vars.put("starter", starter);
        vars.put("leader", leader.getUsername());

        runtimeService.startProcessInstanceByKey(
                "leave_process",
                vars
        );
    }
}


ğŸ“Œ è¿™ä¸€æ­¥æ˜¯ Phase 6 çš„çµé­‚

å…­ã€ä»»åŠ¡ä¼šè‡ªåŠ¨å‘ç”Ÿä»€ä¹ˆï¼Ÿ

å½“æµç¨‹èµ°åˆ°ï¼š

camunda:assignee="${leader}"


Camunda ä¼šï¼š

1ï¸âƒ£ ä»æµç¨‹å˜é‡å– leader
2ï¸âƒ£ å€¼ = "manager01"
3ï¸âƒ£ ä»»åŠ¡ åªä¼šå‡ºç°åœ¨ manager01 çš„å¾…åŠä¸­

ä¸ƒã€å‰ç«¯çœ‹åˆ°çš„æ•ˆæœï¼ˆéå¸¸çœŸå®ï¼‰
ç”¨æˆ·	èƒ½çœ‹åˆ°çš„ä»»åŠ¡
æ™®é€šå‘˜å·¥	âŒ çœ‹ä¸åˆ°
ç›´å±é¢†å¯¼	âœ… çœ‹åˆ°å®¡æ‰¹ä»»åŠ¡
ç®¡ç†å‘˜	âŒï¼ˆé™¤éä¹Ÿæ˜¯ leaderï¼‰

ğŸ‘‰ è¿™å°±æ˜¯â€œåŠ¨æ€å®¡æ‰¹äººâ€

å…«ã€å‡çº§ï¼šå¤šçº§å®¡æ‰¹ï¼ˆæ‰©å±•ï¼‰

ä½ å¯ä»¥ç»§ç»­å¾€ä¸Šï¼š

vars.put("leader1", leader.getUsername());
vars.put("leader2", leader.getLeaderUsername());


BPMNï¼š

camunda:assignee="${leader2}"

ä¹ã€ä½ ç°åœ¨å·²ç»å®Œæˆäº†ä»€ä¹ˆï¼ˆéå¸¸é‡è¦ï¼‰

ä½ å·²ç»å®ç°äº†ï¼š

âœ… ç”¨æˆ·ä¸Šä¸‹çº§å…³ç³»
âœ… å¯åŠ¨æµç¨‹æ—¶åŠ¨æ€è®¡ç®—å®¡æ‰¹äºº
âœ… BPMN å˜é‡é©±åŠ¨ä»»åŠ¡æŒ‡æ´¾
âœ… å®Œå…¨è„±ç¦»â€œå†™æ­»è§’è‰²â€
âœ… ä¼ä¸šçœŸå®å®¡æ‰¹æ¨¡å‹

è¿™æ˜¯ OA / ERP / BPM ç³»ç»Ÿçš„æ ¸å¿ƒèƒ½åŠ›

åã€ä¸‹ä¸€æ­¥ï¼ˆæ›´é«˜çº§ï¼Œä»»é€‰ï¼‰

ä¸‹é¢è¿™äº›å·²ç»æ˜¯ ä¸­é«˜çº§ BPM é¡¹ç›®èƒ½åŠ›ï¼š

1ï¸âƒ£ Phase 7ï¼šå‰ç«¯æµç¨‹è®¾è®¡å™¨ï¼ˆVue ç”» BPMN + éƒ¨ç½²ï¼‰
2ï¸âƒ£ Phase 8ï¼šä¼šç­¾ / å¹¶è¡Œå®¡æ‰¹ï¼ˆå¤šäººåŒæ—¶æ‰¹ï¼‰
3ï¸âƒ£ Phase 9ï¼šå®¡æ‰¹è®°å½• / æ“ä½œæ—¥å¿— / å®¡è®¡

ä½ åªéœ€è¦å›ä¸€å¥ï¼š

ç»§ç»­ Phase X

æˆ‘ä¼šç»§ç»­ ä¸€å±‚ä¸€å±‚æŠŠä½ è¿™ä¸ªç³»ç»Ÿæ‰“ç£¨åˆ°â€œå…¬å¸æ•¢ä¸Šçº¿â€çº§åˆ«ã€‚